# üîß –û—Ç—á–µ—Ç –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é –æ—à–∏–±–æ–∫ Telegram Training Bot

## üìã –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### ‚úÖ 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
**–ü—Ä–æ–±–ª–µ–º–∞**: `object Row can't be used in 'await' expression` –≤ `database/database.py:125`

**–†–µ—à–µ–Ω–∏–µ**: –£–±—Ä–∞–ª `await` —Å `result.fetchone()`
```python
# –ë—ã–ª–æ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
await result.fetchone()

# –°—Ç–∞–ª–æ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):  
row = result.fetchone()
```

### ‚úÖ 2. –î–æ–±–∞–≤–ª–µ–Ω fallback –¥–ª—è Throttling Middleware  
**–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Redis throttling middleware –Ω–µ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª—Å—è

**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω fallback –Ω–∞ `ThrottlingMiddleware` —Å in-memory —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º
```python
# Fallback –Ω–∞ in-memory throttling –±–µ–∑ Redis
from middlewares.throttling import ThrottlingMiddleware
throttling_middleware = ThrottlingMiddleware(
    default_rate=3.0,    
    max_warnings=3,      
    block_duration=120   
)
```

### ‚úÖ 3. –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
**–°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `.env` —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏:**
- SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (—Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
- –û—Ç–∫–ª—é—á–µ–Ω Redis –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- Fallback –Ω–∞ MemoryStorage + Memory Throttling

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ —Å–µ–π—á–∞—Å

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ (–±–µ–∑ Redis)
```bash
cd /workspace/telegram-training-bot

# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –≤ .env —Ñ–∞–π–ª–µ
# –ó–∞–º–µ–Ω–∏—Ç–µ YOUR_BOT_TOKEN_HERE –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω –æ—Ç @BotFather

# 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (—É–∂–µ —Å–¥–µ–ª–∞–Ω–æ)
# uv pip install -r requirements.txt

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞
python bot.py
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü–æ–ª–Ω—ã–π –∑–∞–ø—É—Å–∫ (—Å Redis)
```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Redis
sudo apt update
sudo apt install redis-server

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ Redis
sudo systemctl start redis-server
sudo systemctl enable redis-server

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
redis-cli ping
# –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å: PONG

# 4. –û–±–Ω–æ–≤–∏—Ç–µ .env —Ñ–∞–π–ª (—É–∂–µ –≥–æ—Ç–æ–≤)
# REDIS_URL=redis://localhost:6379

# 5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞
python bot.py
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```
üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
   –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: ‚úÖ OK
   Redis: ‚ö†Ô∏è FALLBACK

üéâ –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç!
üí° –ë–æ—Ç –≥–æ—Ç–æ–≤ –∫ –∑–∞–ø—É—Å–∫—É (–¥–∞–∂–µ –±–µ–∑ Redis)
```

## üõ°Ô∏è –°–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –° Redis (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):
- ‚úÖ Redis Storage –¥–ª—è FSM (—Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ)
- ‚úÖ Redis Throttling —Å —Ç–æ–∫–µ–Ω-–±–∞–∫–µ—Ç –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞ –∏ DDoS –∞—Ç–∞–∫
- ‚úÖ High Availability —á–µ—Ä–µ–∑ Redis Sentinel

### –ë–µ–∑ Redis (—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞):
- ‚úÖ MemoryStorage (—Å–æ—Å—Ç–æ—è–Ω–∏—è —Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ, –Ω–æ –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç)
- ‚úÖ Memory Throttling (–±–∞–∑–æ–≤–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞)
- ‚úÖ –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±–æ—Ç–∞ –¥–æ—Å—Ç—É–ø–Ω—ã
- ‚ö†Ô∏è –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞

## üîß –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

1. **`database/database.py`** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Å—Ç—Ä–æ–∫–∞ 125
2. **`bot.py`** - –¥–æ–±–∞–≤–ª–µ–Ω fallback –¥–ª—è throttling middleware  
3. **`.env`** - —Å–æ–∑–¥–∞–Ω –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
4. **`test_fixes.py`** - —Å–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
5. **`start_redis.sh`** - —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ Redis

## üéØ –°—Ç–∞—Ç—É—Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

| –ü—Ä–æ–±–ª–µ–º–∞ | –°—Ç–∞—Ç—É—Å | –†–µ—à–µ–Ω–∏–µ |
|----------|--------|---------|
| ‚ùå "object Row can't be used in 'await' expression" | ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û** | –£–±—Ä–∞–ª await —Å fetchone() |
| ‚ùå Redis –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω | ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û** | Fallback –Ω–∞ MemoryStorage |
| ‚ùå ThrottlingMiddleware –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω | ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û** | Fallback –Ω–∞ ThrottlingMiddleware |
| ‚ùå –û—à–∏–±–∫–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞ | ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û** | –í—Å–µ middleware —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è |

## üí° –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞** –æ—Ç [@BotFather](https://t.me/BotFather)
2. **–û–±–Ω–æ–≤–∏—Ç–µ .env —Ñ–∞–π–ª** —Å —Ä–µ–∞–ª—å–Ω—ã–º —Ç–æ–∫–µ–Ω–æ–º
3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç**: `python test_fixes.py`
4. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞**: `python bot.py`

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –ø—Ä–æ–±–ª–µ–º—ã:

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
python -c "from config import load_config; print('‚úÖ Config OK')"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö  
python test_fixes.py

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
tail -f logs/*.log
```

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã!** 

–ë–æ—Ç —Ç–µ–ø–µ—Ä—å –º–æ–∂–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –∏ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –¥–≤—É—Ö —Ä–µ–∂–∏–º–∞—Ö:
- üü¢ **–ë–µ–∑ Redis** - –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- üîµ **–° Redis** - –¥–ª—è production —Å –ø–æ–ª–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é

–ö–æ–¥ —Å—Ç–∞–ª –±–æ–ª–µ–µ —É—Å—Ç–æ–π—á–∏–≤—ã–º –∫ —Å–±–æ—è–º —Å graceful fallback —Å–∏—Å—Ç–µ–º–æ–π.